{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Shreya's Library{% endblock %}</title>
    <link rel="icon" href="{% static 'icon.png' %}" type="image/png">
    <link rel="shortcut icon" href="{% static 'icon.png' %}" type="image/png">

    <!-- Bootstrap FIRST -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600;700&family=Lora:wght@400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Your Custom CSS LAST (so it can override Bootstrap) -->
    <link rel="stylesheet" href="{% static 'css/global.css' %}">

    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- Falling leaves animation -->
    <div class="leaves-container" id="leavesContainer"></div>

    <div class="main-container">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <span class="book-icon">üçÇ</span>
                    Shreya's Library
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto align-items-center">
                        <li class="nav-item">
                            <a class="nav-link" href="/"><i class="fas fa-mug-hot me-2"></i>Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'random_book' %}"><i
                                    class="fas fa-dice me-2"></i>Random</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'my_books' %}">
                                <i class="fas fa-book me-2"></i>My Books
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/book/add/">
                                <i class="fas fa-pencil me-2"></i>Add Book
                            </a>
                        </li>
                        <li class="nav-item">
                            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
                                <i class="fas fa-moon"></i>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Messages -->
        <div class="container mt-3">
            {% block messages %}
            {% endblock %}
        </div>

        <!-- Main Content -->
        <div class="container py-4">
            {% block content %}
            {% endblock %}
        </div>

        <!-- Footer -->
        <footer class="footer text-center">
            <div class="container">
                <p class="mb-2" style="font-size: 2rem;">üçÅ üçÇ üå∞</p>
                <p class="mb-0">
                    Made with <i class="fas fa-heart" style="color: var(--accent-red);"></i> and cozy vibes
                </p>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    {% block extra_js %}{% endblock %}

    <script>
        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            const icon = document.querySelector('#themeToggle i');

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Load saved theme
        document.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const icon = document.querySelector('#themeToggle i');
            icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';

            // Create falling leaves
            createFallingLeaves();

            // Initialize toasts
            var toastElList = [].slice.call(document.querySelectorAll('.toast'));
            var toastList = toastElList.map(function (toastEl) {
                var toast = new bootstrap.Toast(toastEl, { delay: 5000 });
                toast.show();
                return toast;
            });
        });

        // Falling leaves animation
        function createFallingLeaves() {
            const container = document.getElementById('leavesContainer');
            const leafEmojis = ['üçÇ', 'üçÅ', 'üå∞'];
            const leafCount = 15;

            for (let i = 0; i < leafCount; i++) {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                leaf.textContent = leafEmojis[Math.floor(Math.random() * leafEmojis.length)];
                leaf.style.left = Math.random() * 100 + '%';
                leaf.style.animationDuration = (Math.random() * 10 + 15) + 's';
                leaf.style.animationDelay = Math.random() * 5 + 's';
                container.appendChild(leaf);
            }
        }
    </script>
</body>

</html>